name: Release

on: push
  # push:
    # tags:
    #   - 'v*'

jobs:
  release:
    name: Draft Release
    runs-on: macOS-12

    steps:
      - name: Download prebuilt binaries
        uses: dawidd6/action-download-artifact@v2
        with:
          workflow: build.yml
          workflow_conclusion: success
          path: pkg
          run_number: 98

      - name: Display structure of downloaded files
        run: ls -R

      - name: Rename Windows-x86_64 bundle
        working-directory: pkg/Windows-x86_64
        run: ls -R;mv **/*.exe uwe-0.0.0-Windows-x86_64.exe

      - name: Rename macOS x86_64 bundle
        working-directory: pkg/macOS-x86_64
        run: mv **/*.dmg uwe-${{ github.ref_name }}-macOS-x86_64.dmg
      
      - name: Rename macOS arm64 bundle
        run: cd pkg/macOS\ arm64;mv **/*.dmg uwe-${{ github.ref_name }}-macOS-arm64.dmg

      - name: Rename Linux x86_64 file
        run: cd pkg/Linux\ x86_64;mv **/*.deb uwe-${{ github.ref_name }}-Linux-x86_64.deb

      - name: Display structure of renamed files
        run: tree

      # - uses: ncipollo/release-action@v1
      #   with:
      #     name: Untitled Waypoint Editor v${{ github.ref_name }}
      #     tag: ${{ github.ref_name }}
      #     artifacts: "pkg/**/*.exe,pkg/**/*.dmg,pkg/**/*.deb"
      #     draft: true
      #     prerelease: true
